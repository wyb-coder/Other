Linux网络设备驱动开发实验

# 1    实验1：Linux网络设备驱动开发实验

## 1.1   目标：

在这个实验中，您将读懂linux网络设备驱动程序例子，并且实际加载驱动程序，加载进操作系统以后，会随着上层应用程序的触发而执行相应动作，具体执行的动作可以通过代码进行改变。

l 读懂源码及makefile

l 编译驱动程序

l 加载

l 多种形式触发动作

## 1.2   预备知识：

l 熟悉linux驱动基本原理，能读懂简单的makefile。

## 1.3   实验预计时间：

80-120分钟

## 1.4   驱动程序部分具体步骤

提示：要求读懂一个最简单的驱动程序，在驱动程序的诸如“xxx_open”、“xxx_read”等标准接口里面加入打印语句。可参考多模式教学网上的驱动样例。

## 1.5   用于触发驱动动作的应用程序及命令

提示：驱动程序就是以静态的标准接口库函数形式存在，网络设备驱动会受到两大类情况的触发，一种是linux里面的控制台里面的命令，另一种是套接口应用程序，首先要搞清都有哪些具体的命令和应用程序流程，应用程序参考多模式教学网的例子。

## 1.6   运行测试

提示：需要将驱动程序以模块形式加载进系统中，并且触发应用程序调用各种文件操作的接口函数，使得驱动有所动作，打印出相关信息。

1. 编译驱动：

cd /某某目录/vnetdev/

make clean

make

2. 加载驱动与打开网卡：

insmod netdrv.ko

ifconfig vnet0 up

3. 运行应用程序

../raw

4. 通过命令“修改网卡MTU”触发驱动执行动作：

ifconfig vnet0 mtu 1222

5. 显示内核打印：

cat /var/log/messages

6. 卸载：

ifconfig vnet0 down

rmmod netdrv.ko

7. 修改代码中的某些函数中的打印信息，重新试验上述流程。

至此大家都应该真正理解和掌握了驱动程序-操作系统-应用程序的三者联动机制。

## 1.7   实验报告提交物要求：

需要提交截图，截图里面要有的内容是应用程序和驱动运行起来的界面，要有网络连接部分的mac地址信息。

**注意！要在一张图里面。**
